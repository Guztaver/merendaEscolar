<div class="container">
    <div class="header">
        <h1 class="text-2xl font-bold text-gray-800">Registrar Movimenta√ß√£o de Estoque</h1>
        <a [routerLink]="['/logistics/dashboard']" class="btn btn-secondary">Voltar ao Painel</a>
    </div>

    @if (errorMessage()) {
        <div class="alert alert-error">
            {{ errorMessage() }}
        </div>
    }

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="movement-form">
        <div class="form-grid">
            <!-- Dados da Movimenta√ß√£o -->
            <div class="form-section">
                <h2 class="section-title">Dados da Movimenta√ß√£o</h2>

                <div class="form-group">
                    <label for="stockItemId">Item do Estoque *</label>
                    <select id="stockItemId" formControlName="stockItemId" class="form-control">
                        <option value="">Selecione um item...</option>
                        @for (item of stockItems(); track item.id) {
                            <option [value]="item.id">{{ item.name }} ({{ item.currentQuantity }} {{ item.unit }})</option>
                        }
                    </select>
                    @if (isFieldInvalid('stockItemId')) {
                        <span class="error-message">{{ getErrorMessage('stockItemId') }}</span>
                    }
                </div>

                <div class="form-row">
                    <div class="form-group flex-1">
                        <label for="movementType">Tipo de Movimenta√ß√£o *</label>
                        <select id="movementType" formControlName="movementType" class="form-control">
                            @for (type of [MovementType.IN, MovementType.OUT, MovementType.ADJUSTMENT]; track type) {
                                <option [value]="type">{{ getMovementTypeLabel(type) }}</option>
                            }
                        </select>
                    </div>

                    <div class="form-group flex-1">
                        <label for="reason">Motivo *</label>
                        <select id="reason" formControlName="reason" class="form-control">
                            @for (reason of getAvailableReasons(); track reason) {
                                <option [value]="reason">{{ getReasonLabel(reason) }}</option>
                            }
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="quantity">Quantidade *</label>
                    <input
                        type="number"
                        id="quantity"
                        formControlName="quantity"
                        class="form-control"
                        step="0.01"
                        min="0.01"
                    />
                    @if (isFieldInvalid('quantity')) {
                        <span class="error-message">{{ getErrorMessage('quantity') }}</span>
                    }
                </div>

                <div class="form-group">
                    <label for="notes">Observa√ß√µes</label>
                    <textarea
                        id="notes"
                        formControlName="notes"
                        class="form-control"
                        rows="3"
                        placeholder="Informa√ß√µes adicionais sobre esta movimenta√ß√£o..."
                    ></textarea>
                </div>
            </div>

            <!-- Detalhes Adicionais -->
            <div class="form-section">
                <h2 class="section-title">Detalhes Adicionais</h2>

                <div class="form-group">
                    <label for="batchNumber">N√∫mero do Lote</label>
                    <input
                        type="text"
                        id="batchNumber"
                        formControlName="batchNumber"
                        class="form-control"
                        placeholder="C√≥digo do lote (opcional)"
                    />
                </div>

                <div class="form-group">
                    <label for="expiryDate">Data de Validade</label>
                    <input
                        type="date"
                        id="expiryDate"
                        formControlName="expiryDate"
                        class="form-control"
                    />
                </div>

                <div class="form-group">
                    <label for="documentNumber">N√∫mero do Documento</label>
                    <input
                        type="text"
                        id="documentNumber"
                        formControlName="documentNumber"
                        class="form-control"
                        placeholder="Nota fiscal, documento de doa√ß√£o, etc."
                    />
                </div>

                <div class="info-box">
                    <strong>üí° Dica:</strong>
                    <p>Para entradas, preencha o n√∫mero do lote e validade para controle de vencimentos.</p>
                    <p>Para sa√≠das por uso, indique qual prepara√ß√£o ser√° feita nas observa√ß√µes.</p>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn btn-secondary" (click)="cancel()">Cancelar</button>
            <button type="submit" class="btn btn-primary" [disabled]="isLoading()">
                @if (isLoading()) {
                    Registrando...
                } @else {
                    Registrar Movimenta√ß√£o
                }
            </button>
        </div>
    </form>
</div>
